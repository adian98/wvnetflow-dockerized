# =====================================
#   Airstream flowage config
# =====================================

# ----------------------------------------------------------------------------
# Define some file locations
# ----------------------------------------------------------------------------
directory watch /webview/netflow/capture/2055
directory data  /webview/netflow/data
directory temp  /webview/netflow/tmp/asn
directory cache /webview/netflow/tmp/common
directory hierarchical

logging file flowage-asn.log
logging size 1_000_000
index file flowage-asn.idx

# ----------------------------------------------------------------------------
# Define all the netflow exporters that we'll see data from.
# ----------------------------------------------------------------------------

exporter ACME7200-1 64.93.172.150 monitor
exporter ACME7200-2 64.93.172.151 monitor
exporter no-unknown-exporters

# localnexthop 64.93.171.161 64.93.171.177 64.93.171.164 64.93.171.180

# ----------------------------------------------------------------------------
# Define the ASN matrix. The following config is taken directly from asnbuild.pl
# except for the "ACME Internet" and "xform=31935:0" lines (normally the local ASN
# is reported as 0 in netflow records, so those lines convert 0 back to what it
# should be).
# ----------------------------------------------------------------------------

as-matrix ASN
        #
        # Descriptions of ASN's
        #
        descriptions=asn-descriptions.txt
        aliases=simple
        #
        # List of ASN's we are interested in
        #
        174 209 577 701 812 1239 1299 1668 2119 2140 2381 2386 2856 2914 3215 3257 3269 3301 3352 3356 3491 3549 3561 3599 4134 4181 4264 4323 4764 4835 4837 5089 5462 5615 5668 5779 6128 6327 6432 6453 6848 6939 6967 7018 7132 7260 7725 7757 7973 8075 8151 9038 10796 10879 10912 10994 11139 11260 11393 11426 11427 11449 11643 11662 11697 11796 12182 12271 13367 13768 14173 14703 14776 14779 14780 14912 14960 15100 15169 15267 15557 16086 16265 19108 19166 19262 20094 20115 20214 20473 20940 21844 22384 22773 22822 23352 23393 23430 25973 26910 27524 29748 30094 30361 31898 32746 32934 32968 33287 33491 33651 33739 33970 36472 36561 36727 36839 38930 40027
	64512 64513 64514 64515 64156 64517
        #
        # Transformations of other ASN ranges
        #
	# ACME Internet
	xform=31935:0
        # ARIN
        xform=64512:1-173,175-208,210-576,578-700,702-811,813-1238,1240-1298,1300-1667,1669-1876,1902-2042,2044-2046,2048-2106,2137-2139,2141-2380,2382-2385,2387-2584,2615-2772,2823-2829,2880-2913,2915-3153,3354-3355,3357-3490,3492-3548,3550-3560,3562-3598,3600-4133,4135-4180,4182-4263,4265-4322,4324-4607,4865-5088,5090-5376,5632-5667,5669-5778,5780-6127,6129-6326,6328-6431,6433-6452,6454-6655,6912-6938,6940-6966,6968-7017,7019-7131,7133-7259,7261-7466,7723-7724,7726-7756,7758-7972,7974-8074,8076-8150,8152-8191,10240-10795,10797-10878,10880-10911,10913-10993,10995-11138,11140-11259,11261-11392,11394-11425,11428-11448,11450-11642,11644-11661,11663-11696,11698-11795,11797-12181,12183-12270,12272-12287,13312-13366,13368-13767,13769-14172,14174-14702,14704-14775,14777-14778,14781-14911,14913-14959,14961-15099,15101-15168,15170-15266,15268-15359,16384-17407,18432-19107,19109-19165,19167-19261,19263-20093,20095-20114,20116-20213,20215-20472,20474-20479,21504-21843,21845-22383,22385-22772,22774-22821,22823-23351,23353-23392,23394-23429,23431-23455,23457-23551,25600-25972,25974-26909,26911-27523,27525-27647,29696-29747,29749-30093,30095-30360,30362-30719,31744-31897,31899-32745,32747-32933,32935-32967,32969-33286,33288-33490,33492-33650,33652-33738,33740-33791,35840-36471,36473-36560,36562-36726,36728-36838,36840-36863,39936-40026,40028-40959
        # RIPE
        xform=64513:1877-1901,2043,2047,2107-2118,2120-2136,2585-2614,2773-2822,2830-2855,2857-2879,3154-3214,3216-3256,3258-3268,3270-3300,3302-3351,3353,5377-5461,5463-5614,5616-5631,6656-6847,6849-6911,8192-9037,9039-9215,12288-13311,15360-15556,15558-16085,16087-16264,16266-16383,20480-20939,20941-21503,24576-25599,28672-29695,30720-31743,33792-33969,33971-35839,38912-38929,38931-39935,40960-45055
        # APNIC
        xform=64514:4608-4763,4765-4834,4836,4838-4864,7467-7722,9216-10239,17408-18431,23552-24575,37888-38911,45056-46079
        # Reserved
        xform=64515:23456,46080-64511,64518-65535
        # LACNIC
        xform=64516:27648-28671
        # AfriNIC
        xform=64517:36864-37887

# ----------------------------------------------------------------------------
# Now, define output files based on various combinations of this data that
# might be interesting to look at.
# ----------------------------------------------------------------------------

datafile rrd Core-ASN
	InternetEgress			# ACL to limit traffic to process
	ASN 				# ASN Matrix
	Consolidation=MAX:1:14:365

ip access-list extended InternetEgress
 permit ip any Gig0/3 any exporter ACME7200-2 reverse
 permit ip any Gig0/3 any exporter ACME7200-1 reverse


